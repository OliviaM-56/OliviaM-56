<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>For You</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600&family=Poppins:wght@300;400&display=swap" rel="stylesheet">

    <style>
        /* --- CSS STYLING --- */
        :root {
            --primary-pink: #d48ba0;
            --glass-bg: rgba(255, 255, 255, 0.4);
            --glass-border: rgba(255, 255, 255, 0.7);
            --text-main: #5d4048; 
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            background: linear-gradient(120deg, #fdfbfb 0%, #fcecef 100%);
            color: var(--text-main);
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            text-align: center;
            font-family: 'Poppins', sans-serif; 
        }

        .container {
            width: 100%;
            max-width: 800px;
            padding: 2rem;
            position: relative;
            z-index: 10;
        }

        /* SLIDE TRANSITIONS */
        .slide {
            display: none;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity 0.8s ease-in-out;
            height: 100%;
            width: 100%;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .slide.active {
            display: flex;
            opacity: 1;
        }

        /* TYPOGRAPHY */
        h1 {
            font-family: 'Playfair Display', serif;
            font-size: 2.8rem;
            margin-bottom: 2.5rem;
            font-weight: 600;
            color: #4a3b40;
            line-height: 1.3;
        }

        p {
            font-size: 1.15rem;
            line-height: 1.9;
            color: #6e5d62;
            max-width: 650px;
            font-weight: 300;
        }

        /* GLASSMORPHISM INPUT */
        input[type="text"] {
            padding: 18px 25px;
            font-size: 1.1rem;
            font-family: 'Poppins', sans-serif;
            border: 1px solid var(--glass-border);
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border-radius: 50px;
            outline: none;
            color: var(--text-main);
            text-align: center;
            margin-bottom: 30px;
            width: 80%;
            max-width: 400px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
        }
        
        input[type="text"]:focus {
            background: rgba(255, 255, 255, 0.8);
            box-shadow: 0 8px 25px rgba(212, 139, 160, 0.2);
            border-color: var(--primary-pink);
        }

        .btn-group {
            display: flex;
            flex-direction: column;
            gap: 18px;
            width: 100%;
            align-items: center;
        }

        /* BUTTONS */
        button {
            background-color: var(--primary-pink);
            color: white;
            border: none;
            padding: 16px 40px;
            font-size: 1rem;
            font-family: 'Poppins', sans-serif;
            letter-spacing: 0.5px;
            border-radius: 50px;
            cursor: pointer;
            width: 100%;
            max-width: 380px;
            box-shadow: 0 5px 15px rgba(212, 139, 160, 0.3);
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(212, 139, 160, 0.5);
            background-color: #d997ab;
        }

        /* LETTER AREA */
        #letter-content {
            cursor: pointer;
            min-height: 280px; 
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
            padding: 0 20px;
        }

        /* PROGRESS DOTS */
        .progress-container {
            display: flex;
            gap: 8px;
            margin-top: 30px;
            opacity: 0;
            transition: opacity 0.5s;
        }
        
        .progress-dot {
            width: 8px;
            height: 8px;
            background-color: #e0e0e0;
            border-radius: 50%;
            transition: background-color 0.3s;
        }
        
        .progress-dot.active {
            background-color: var(--primary-pink);
            transform: scale(1.2);
        }

        .cursor {
            display: inline-block;
            width: 2px;
            background-color: var(--primary-pink);
            animation: blink 1s step-end infinite;
        }

        @keyframes blink { 50% { opacity: 0; } }

        .hint {
            font-size: 0.75rem;
            letter-spacing: 1px;
            text-transform: uppercase;
            color: #998a8e;
            margin-top: 3rem;
            opacity: 0;
            transition: opacity 0.5s;
        }

        /* POPUP */
        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(8px);
            display: flex;
            justify-content: center;
            align-items: center;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
            z-index: 100;
        }

        .popup-overlay.show { opacity: 1; pointer-events: all; }

        .popup-box {
            background: white;
            padding: 2.5rem;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            max-width: 90%;
            width: 400px;
            text-align: center;
        }
        
        .popup-box p { margin-bottom: 20px; }

    </style>
</head>
<body>

    <div class="container">
        
        <div id="slide-name" class="slide active">
            <h1>State your name:</h1>
            <input type="text" id="nameInput" placeholder="Type here..." autocomplete="off">
            <button onclick="submitName()">Enter</button>
        </div>

        <div id="slide-role" class="slide">
            <h1 id="greeting-text">Hi Name! Who are you to Lutfi?</h1>
            <div class="btn-group">
                <button onclick="handleRole('friend')">Friends, I rejected him</button>
                <button onclick="handleRole('girlfriend')">Just started to be his girlfriend</button>
                <button onclick="handleRole('wife')">His wife apparently</button>
                <button onclick="handleRole('ex')">His ex</button>
            </div>
        </div>

        <div id="slide-rejection" class="slide">
            <h1>Are you sure? :(</h1>
            <div class="btn-group">
                <button onclick="endPresentation()">Yes</button>
                <button onclick="goBackToRole()">No</button>
            </div>
        </div>

        <div id="slide-end" class="slide">
            <h1>Okay...</h1>
            <p>I understand. Have a nice day.</p>
        </div>

        <div id="slide-letter" class="slide">
            <div id="letter-content" onclick="handleClick()">
                <p><span id="letter-text"></span><span id="cursor" class="cursor">|</span></p>
            </div>
            
            <div id="progress-container" class="progress-container"></div>
            <p class="hint" id="hint-text">(Tap to continue)</p>
        </div>

    </div>

    <div id="custom-popup" class="popup-overlay">
        <div class="popup-box">
            <p id="popup-message"></p>
            <button onclick="closePopup()">Okay</button>
        </div>
    </div>

    <script>
        /* --- JAVASCRIPT LOGIC --- */

        let userName = "";
        let letterIndex = 0;
        let charIndex = 0;
        let isTyping = false;
        let typingTimeout; // Changed from interval to timeout
        let currentText = "";

        const letterParagraphs = [
            "Hi Aulin",
            "If you’re reading this, it means you said yes. I just want you to know that there’s nothing in this world that can even slightly describe how happy I am right now.",
            "Without realizing it, I’ve been admiring you since the first time we met. Remember that gathering where you were the coordinator of my group? I was looking at everyone there, and honestly, the only reason I even wanted to participate was because I wanted to see you HAHAHA. That’s why I texted you. That’s why I noticed you didn’t invite me to the group chat, HAHAHA. But I guess I wasn’t bold enough to talk to you any further.",
            "Time passed, and I didn’t see you at TPB at all. heck I even forgot that I once had a crush on you wkwkwk. Then MBC happened. I met someone again, someone I hadn’t seen in a long time. But now without glasses, and I fell in love again without even noticing at first that it was you hahah. Scared at first, but I really hit you with a “Aulin kita udah wawancara belum?” and you said “belum”, “ayo join join” and then you joined :’)",
            "Throughout the wawancara I’m really trying my best not to stare at you and I hope you didn’t noticed it hahah sorry. And after that, I started asking your friends about you, and well… you know the rest is history :)",
            "I’m not really good with people, especially communicating. I feel like I can be either too quiet or too loud. So if the ride home today felt awkward, I’m sorry :( And sorry in advance if something like that happens again. I have a feeling it will heheh.",
            "Lastly, I’m not the fun guy who can make you laugh. I’m not the smart one who gets straight A’s. I’m not the rich gentleman who can buy you everything you want. Sometimes I’m weird and do not know how to talk to you.",
            "I’m not perfect, not even a good man to begin with. I’m just an ordinary boy who happens to be in love with you. And I’m sorry for my imperfections. I can’t promise a perfect future for you, or even a good one. But I can promise that I’ll be present. And I’ll try to make a present where both of us feel safe enough to stay, without fear.",
            "With all that said, thank you, Aulin. You’ve made me very happy. I hope that someday, I can make you the happiest girl alive too. Makasih :( I really mean it"
        ];

        // 1. Submit Name
        function submitName() {
            const input = document.getElementById('nameInput').value;
            if (!input) return alert("Please tell me your name first :)");
            
            userName = input.trim().split(' ')[0]; 
            document.getElementById('greeting-text').innerText = `Hi ${userName}! Who are you to Lutfi?`;
            changeSlide('slide-name', 'slide-role');
        }

        // 2. Role Selection
        function handleRole(role) {
            if (role === 'friend') {
                changeSlide('slide-role', 'slide-rejection');
            } else if (role === 'girlfriend') {
                startLetter();
            } else if (role === 'wife') {
                showPopup("I think that's a little bit too fast to even be in a consideration");
            } else if (role === 'ex') {
                showPopup("He will not let you be his ex I'm afraid :) Unless if you two are married which is still too early innit?");
            }
        }

        function endPresentation() {
            changeSlide('slide-rejection', 'slide-end');
        }

        function goBackToRole() {
            changeSlide('slide-rejection', 'slide-role');
        }

        // 3. Start Letter & Dots
        function startLetter() {
            changeSlide('slide-role', 'slide-letter');
            
            const dotsContainer = document.getElementById('progress-container');
            dotsContainer.innerHTML = '';
            for(let i=0; i<letterParagraphs.length; i++) {
                const dot = document.createElement('div');
                dot.classList.add('progress-dot');
                if(i === 0) dot.classList.add('active');
                dotsContainer.appendChild(dot);
            }
            dotsContainer.style.opacity = 1;

            letterIndex = 0;
            setTimeout(() => {
                prepareTyping(letterParagraphs[letterIndex]);
            }, 1000);
        }

        // 4. SMART TYPING LOGIC
        function prepareTyping(text) {
            const textElement = document.getElementById('letter-text');
            const hintElement = document.getElementById('hint-text');
            const cursor = document.getElementById('cursor');
            
            currentText = text;
            textElement.innerHTML = "";
            charIndex = 0;
            isTyping = true;
            hintElement.style.opacity = 0;
            cursor.style.display = "inline-block";

            typeNextChar(); // Start the recursion
        }

        function typeNextChar() {
            if (!isTyping) return;

            const textElement = document.getElementById('letter-text');
            const currentChar = currentText.charAt(charIndex);
            
            textElement.innerHTML += currentChar;
            charIndex++;

            if (charIndex < currentText.length) {
                let nextDelay = 35; // Default typing speed

                // Check for Sentence Endings (. ? !)
                if (currentChar === '.' || currentChar === '?' || currentChar === '!') {
                    // Check if it is NOT an ellipsis (e.g. not "...")
                    // If next char is also a dot, it's an ellipsis, so don't pause long
                    if (charIndex < currentText.length && currentText.charAt(charIndex) === '.') {
                        nextDelay = 35; 
                    } else {
                        nextDelay = 700; // PAUSE HERE (1.5s)
                    }
                } 
                // Optional: Tiny pause for commas
                else if (currentChar === ',') {
                    nextDelay = 200; 
                }

                typingTimeout = setTimeout(typeNextChar, nextDelay);
            } else {
                finishTyping();
            }
        }

        function finishTyping() {
            clearTimeout(typingTimeout);
            isTyping = false;
            document.getElementById('letter-text').innerHTML = currentText;
            document.getElementById('hint-text').style.opacity = 0.6;
        }

        function handleClick() {
            if (isTyping) {
                finishTyping(); // Click to skip typing
            } else {
                nextLetterSlide(); // Click to next slide
            }
        }

        function nextLetterSlide() {
            if (letterIndex < letterParagraphs.length - 1) {
                letterIndex++;
                updateDots(letterIndex);
                prepareTyping(letterParagraphs[letterIndex]);
            } else {
                document.getElementById('hint-text').innerText = "❤️";
                document.getElementById('cursor').style.display = "none";
            }
        }

        function updateDots(index) {
            const dots = document.querySelectorAll('.progress-dot');
            dots.forEach((dot, i) => {
                if(i === index) dot.classList.add('active');
                else dot.classList.remove('active');
            });
        }

        // Helper: Slides
        function changeSlide(currentId, nextId) {
            const current = document.getElementById(currentId);
            const next = document.getElementById(nextId);

            current.style.opacity = 0;
            current.style.pointerEvents = 'none';
            
            setTimeout(() => {
                current.classList.remove('active');
                next.classList.add('active');
                void next.offsetWidth;
                next.style.opacity = 1;
                next.style.pointerEvents = 'all';
            }, 800);
        }

        function showPopup(message) {
            document.getElementById('popup-message').innerText = message;
            document.getElementById('custom-popup').classList.add('show');
        }

        function closePopup() {
            document.getElementById('custom-popup').classList.remove('show');
        }

        document.getElementById("nameInput").addEventListener("keypress", function(event) {
            if (event.key === "Enter") submitName();
        });

    </script>
</body>
</html>